<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
	<title>internet hotspot > login</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="pragma" content="no-cache" />
	<meta http-equiv="expires" content="-1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<style>
		body {
			font-family: 'Roboto';
		}
	</style>
</head>

<body>
	$(if chap-id)
	<!--Parte que faz login no RB-->
	<form name="sendin" action="$(link-login-only)" method="post">
		<input type="hidden" name="username" value="hotspot" />
		<input type="hidden" name="password" />
		<!--<input type="hidden" name="dst" value="$(link-orig)" />-->
		<input type="hidden" name="popup" value="true" />
	</form>

	<script type="text/javascript" src="/md5.js"></script>
	<script type="text/javascript">

		function doLogin() {
			console.log("doLogin");
			//document.sendin.password.value = hexMD5('$(chap-id)' + "12345678" + '$(chap-challenge)');
			//document.sendin.submit();
			return false;
		}
	</script>

	$(endif)

	<div name="login" action="$(link-login-only)" method="post" $(if chap-id) onSubmit="return doLogin()"
		$(endif)>

		<div class="segment">
			<h1>Nome do Estabelecimento</h1>
			<p>Preencha o formulário ou entre com uma conta do Google
				 ou Facebook para liberar o acesso ao Wifi</p>
		</div>

		<form id="formulario" class="input-group form">
			<!--<input type="hidden" name="macaddress" value="$(mac)" /> função para obter macaddress -->
			<label>
				<input type="text" name="nome" placeholder="Nome" />
			</label>
			<label>
				<input type="email" name="email" placeholder="Email" required/>
			</label>
			<label>
				<input type="tel" name="telefone" placeholder="Telefone" required  pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}"/>
			</label>
			<button class="red" name="login" type="submit"><i class="icon ion-md-lock"></i> Login </button>
		</form>

		<div class="btn-group" id="btn-group">
			<button class="unit" id="buttonForm" type="button"> Formulário </button>
			<div class="social-auth">
				<button class="unit" name="button2" type="button"> Conta Google </button>
				<button class="unit" name="button3" type="button"> Facebook </button>
			</div>
		</div>

	</div>

	<script type="module">
		// Podemos criar um arquivo .js para tirar esse script daqui, to deixando ele aqui por enquanto para ficar mais facil de editar  

		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
		import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-analytics.js";
		import { getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-firestore.js";
		import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-auth.js";
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyAmyH-aOtU-zpOnun7V02FOGf35Z2KuOCM",
			authDomain: "projeto-x-450d9.firebaseapp.com",
			projectId: "projeto-x-450d9",
			storageBucket: "projeto-x-450d9.appspot.com",
			messagingSenderId: "647232373948",
			appId: "1:647232373948:web:18e0179590cfc2208b3cb9",
			measurementId: "G-NGG7L31LKE"
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const analytics = getAnalytics(app);
		const db = getFirestore(app);
		const auth = getAuth(app);
		const provider = new GoogleAuthProvider();

		function showForm() {
			document.getElementById("formulario").style.display = "flex";
			document.getElementById("btn-group").style.display = "none";
		}

		async function gravar(Mac, Nome, Email, Telefone) {

			try {
				const docRef = await addDoc(collection(db, "users"), {
					macaddress: Mac,
					nome: Nome,
					email: Email,
					telefone: Telefone
				});
				console.log("Document written with ID: ", docRef.id);
			} catch (e) {
				console.error("Error adding document: ", e);
			}


		}

		function loginGoogle() {
			signInWithPopup(auth, provider)
				.then((result) => {
					// The signed-in user info.
					const user = result.user;
					console.log(user);
					gravar("0", user.displayName, user.email, user.phoneNumber);

				}).catch((error) => {
					// Handle Errors here.
					const errorCode = error.code;
					const errorMessage = error.message;
					// The email of the user's account used.
					const email = error.customData.email;
					// The AuthCredential type that was used.
					const credential = GoogleAuthProvider.credentialFromError(error);
					// ...
				});
		}

		const buttonForm = document.getElementById("buttonForm");
		const buttonFacebook = document.getElementById("buttonFacebook");
		const buttonGoogle = document.getElementById("buttonGoogle");

		buttonForm.addEventListener('click', () => showForm());
		buttonGoogle.addEventListener('click', function () { loginGoogle() });
		buttonFacebook.addEventListener('click', function () { gravar("0", document.login.nome.value, document.login.email.value, document.login.telefone.value) });
	</script>



	$(if error)<br />
	<div style="color: #FF8080; font-size: 9px">$(error)</div>$(endif)

</body>

</html>